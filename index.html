 <html>
    <body oncontextmenu="return false;" onselectstart="return false" overscroll-behavior-y: contain;>
		<div>
			<div >
				<input type="text" id="hostAddress" name="hostAddress" value="10.64.3.146">
				<label for="port">Port:</label>
				<input type="text" id="port" name="port" value="12345">
				<input type="button" id="connect" onclick="connectServer()" value="Connect">
				<label for="data" id="lbldata" style="display: none;">Send data:</label>
				<input type="text" id="data" name="data" value="data 1" style="display: none;"><br>
				<input type="button" id="btnData" onclick="sendData()" value="Send Data" style="display: none;"><br>
				
			</div>			
			<div><input type="button" id="btnFullScreen" onclick="toggleFullScreen()" value="Full Screen"></div>			
		</div>       
		
		<div>
			<div style="width: 50%; float:left" align="left">
				<canvas id="dpadCanvas" width="240" height="240" style="border:solid black 1px;" >canvas</canvas>
			</div>
			<div style="width: 50%; float:right" align="right">
			   <table width="120" border="0">
				  <tr>
					<td>&nbsp;</td>
					<td><button class="arrow" ontouchstart="sendAction(7)" ontouchend="sendAction(70)"> <img src="images/buttonY.png" width="60dp" height="60dp" /></button></td>
					<td>&nbsp;</td>
				  </tr>
				  <tr>
					<td><button class="arrow" ontouchstart="sendAction(6)" ontouchend="sendAction(60)"><img src="images/buttonX.png" width="60dp" height="60dp" /> </button></td>
					<td></td>
					<td><button class="arrow" ontouchstart="sendAction(9)" ontouchend="sendAction(90)"><img src="images/buttonB.png" width="60dp" height="60dp" /></button></td>
				  </tr>
				  <tr>
					<td>&nbsp;</td>
					<td><button class="arrow" ontouchstart="sendAction(8)" ontouchend="sendAction(80)"><img src="images/buttonA.png" width="60dp" height="60dp" /> </button></td>
					<td>&nbsp;</td>
				  </tr>
				</table>
			</div>			
		</div>			
		
		<script>
			//----------------- Server begin -----------------//
			let connected = 0;            
            let ws;

            function connectServer() {
                let host = document.getElementById("hostAddress").value;
                let port = document.getElementById("port").value;                
                let hostPortWS = "ws://" + host + ":" + port;
                console.log("hostPortWS: " + hostPortWS);

                ws = new WebSocket(hostPortWS);

                ws.addEventListener("open", () => {
                    console.log("We are connected!");                    
                    connected = 1;					
					document.getElementById("lbldata").style.display = "block";
                    document.getElementById("data").style.display = "block";
                    document.getElementById("btnData").style.display = "block";
                    document.getElementById("connect").setAttribute("disabled", true);
                    document.getElementById("hostAddress").setAttribute("disabled", true);
                    document.getElementById("port").setAttribute("disabled", true);
                })

                ws.addEventListener("message", e => {
                    console.log(e);                    
                });

                ws.addEventListener("close", e => {
                    console.log(e);
                    connected = 0;            
                });

                ws.addEventListener("error", e => {
                    console.log(e);
                });
            }
			
			function sendData() {
                if(connected == 1) {                    
                    let data = document.getElementById("data").value;
                    ws.send(data);
                }
            }
			
			function sendAction(a) {
				console.log("sendAction: " + a);
                if(connected == 1) {
                    let action = a;
                    ws.send(action);
                }
            }
			//----------------- Server end -----------------//		
		
			var dpadArea = new Array;
			var dpadHolding = false;
			var canvasW, canvasH;		
			var arrowW, arrowH;		
			
			function init(){
				var c = document.getElementById("dpadCanvas");
				canvasW = c.width;
				canvasH = c.height;
				arrowW = canvasW/3;
				arrowH = canvasH/3;	
				
				dpadArea = [
					[{x:0, y:0, active:false}, {x:arrowW, y:0, active:false}, {x:arrowW*2, y:0, active:false}],
					[{x:0, y:arrowH, active:false}, {x:arrowW, y:arrowH, active:false}, {x:arrowW*2, y:arrowH, active:false}],
					[{x:0, y:arrowH*2, active:false}, {x:arrowW, y:arrowH*2, active:false}, {x:arrowW*2, y:arrowH*2, active:false}]
				];
			}			
			//----------------- Action -----------------//
			
			function doLeft() {
				console.log("do Left");
				sendAction(1);
			}
			
			function doRight() {
				console.log("do Right");
				sendAction(3);
			}
			
			function doUp() {
				console.log("do Up");
				sendAction(2);
			}
			
			function doDown() {
				console.log("do Down");
				sendAction(4);
			}
		
			function arrowDisactiveAll() {
				for (var i=0; i<3; i++) {
					for (var j=0; j<3; j++) {					
						dpadArea[i][j].active = false;
					}
				}				
			}
			
			function arrowDisactive(a, b) {
				for (var i=0; i<3; i++) {
					for (var j=0; j<3; j++) {					
						dpadArea[i][j].active = false;
					}
				}
				dpadArea[a][b].active = true;
				
				//if (!all) {
				//	dpadArea[a][b].active = true;
				//}
			}
			
			function arrowActiveCount() {
				var count = 0;
				for (var i=0; i<3; i++) {
					for (var j=0; j<3; j++) {
						if (dpadArea[i][j].active == true){
							count += 1;
						}
					}
				}
				return count;
			}
			
			//----------------- Control -----------------//			
			function handleStart(event) {
				dpadHolding = true;				
				var el = document.getElementById("dpadCanvas");
				var x = event.changedTouches[0].pageX - el.getBoundingClientRect().left;
				var y = event.changedTouches[0].pageY - el.getBoundingClientRect().top;								
				
				if (x <= arrowW) {					
					if (y <= arrowH) {						
						//console.log("Left & Up");
					} else if ((y > arrowH) && (y <= arrowH*2)) {
						//console.log("Left");
						dpadArea[1][0].active = true;
						drawDpad(1);
						doLeft();
					} else {						
						//console.log("Left & Down");
					}
				} else if ((x > arrowW) && (x < arrowW*2)) {					
					console.log("Col 2");
					if (y <= arrowH) {						
						//console.log("Up");
						dpadArea[0][1].active = true;
						drawDpad(2);						
						doUp();
					} else if ((y > arrowH) && (y <= arrowH*2)) {						
						//	console.log("Middle");
					} else {						
						//console.log("Down");
						dpadArea[2][1].active = true;
						drawDpad(4);
						doDown();
					}
				} else {
					console.log("Col 3");
					if (y <= arrowH) {						
						//console.log("Right & Up");						
					} else if ((y > arrowH) && (y <= arrowH*2)) {						
						console.log("Row 2");
						//console.log("Right");
						dpadArea[1][2].active = true;
						drawDpad(3);
						doRight();
					} else {
						//console.log("Right & Down");
					}
				}
			}
			
			function handleMove(event) {				
				var el = document.getElementById("dpadCanvas");
				var x = event.changedTouches[0].pageX - el.getBoundingClientRect().left;
				var y = event.changedTouches[0].pageY - el.getBoundingClientRect().top;								
				//var x = event.touches[0].clientX - el.getBoundingClientRect().left;
				//var y = event.touches[0].clientY - el.getBoundingClientRect().top;	
				
				if (x <= arrowW) {					
					if (y <= arrowH) {						
						//console.log("Left & Up - Active");						
					} else if ((y > arrowH) && (y <= arrowH*2)) {						
						if (!dpadArea[1][0].active) {
							drawDpad(1);
							arrowDisactive(1,0);
							doLeft(1);
							//console.log("doLeft - Active");						
						}
					} else {
						//console.log("Left & Down  - Active");						
					}
				} else if ((x > arrowW) && (x <= arrowW*2)) {
					if (y <= arrowH) {					
						if (!dpadArea[0][1].active) {
							drawDpad(2);
							arrowDisactive(0,1);
							doUp(2);							
							//console.log("Up - Active");
						}
					} else if ((y > arrowH) && (y < arrowH*2)) {						
						//console.log("Middle - Active");						
					} else {						
						if (!dpadArea[2][1].active) {
							drawDpad(4);
							arrowDisactive(2,1);
							doDown(4);
							//console.log("Down  - Active");
						}
					}
				} else if ((x > arrowW*2) && (x < arrowW*3)) {					
					if (y <= arrowH) {						
						//console.log("Right & Up  - Active");						
					} else if ((y > arrowH) && (y <= arrowH*2)) {						
						if (!dpadArea[1][2].active) {
							drawDpad(3);
							arrowDisactive(1,2);							
							doRight(3);
							//console.log("Right - Active");							
						}
					} else {						
						//console.log("Right & Down - Active");						
					}
				}
			}
			
			function handleEnd(event) {				
				dpadHolding = false;
				arrowDisactiveAll();
				drawDpad(0);
			}
			
			function handleCancel(event) {
				console.log("Touch Cancel");
			}
			
			function startup() 
			{
				console.log("call startup()");				
				var el = document.getElementById("dpadCanvas");
				el.addEventListener("touchstart", handleStart, false);
				el.addEventListener("touchend", handleEnd, false);
				el.addEventListener("touchmove", handleMove, false);
				el.addEventListener("touchcancel", handleCancel, false);			
			}
			init();						
			//drawDpad();
			drawGrid();			
			document.addEventListener("ContentLoaded", startup());
						
			//window.addEventListener("orientationchange", function() {				
			  //alert(window.orientation);
			//}, false);
			
			//----------------- Webpage -----------------//
			function toggleFullScreen() {
                if(!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                    document.getElementById("btnFullScreen").value = "Exit Full Screen";
					
					


                } else {
                    if(document.exitFullscreen) {
                        document.exitFullscreen();
                        document.getElementById("btnFullScreen").value = "Full Screen";
                    }
                }
            }			
			
			//----------------- Mode -----------------//
			var _LOCK_BUTTON = document.querySelector("#btnLockLandscape");
			var	_UNLOCK_BUTTON = document.querySelector("#btnUnlockLandscape");
			var	_STATUS = document.querySelector("#orientation-status");

			_STATUS.innerHTML = screen.orientation.type + ' mode';

			// upon lock to landscape-primary mode
			document.querySelector("#btnLockLandscape").addEventListener('click', function() {
				if(document.documentElement.requestFullscreen)
					document.querySelector("#container").requestFullscreen();
				else if(document.documentElement.webkitRequestFullScreen)
					document.querySelector("#container").webkitRequestFullScreen();

				screen.orientation.lock("landscape-primary")
					.then(function() {
						_LOCK_BUTTON.style.display = 'none';
						_UNLOCK_BUTTON.style.display = 'block';
					})
					.catch(function(error) {
						alert(error);
					});
			});

			// upon unlock
			document.querySelector("#btnUnlockLandscape").addEventListener('click', function() {
				screen.orientation.unlock();

				_LOCK_BUTTON.style.display = 'block';
				_UNLOCK_BUTTON.style.display = 'none';
			});

			// when screen orientation changes
			screen.orientation.addEventListener("change", function() {
				_STATUS.innerHTML = screen.orientation.type + ' mode';
			});

			// on exiting full-screen lock is automatically released
			document.addEventListener("fullscreenchange", function() {
				_LOCK_BUTTON.style.display = 'block';
				_UNLOCK_BUTTON.style.display = 'none';
			});

			document.addEventListener("webkitfullscreenchange", function() {
				_LOCK_BUTTON.style.display = 'block';
				_UNLOCK_BUTTON.style.display = 'none';
			});

			//----------------- Debug -----------------//
			function drawGrid() {
				var c = document.getElementById("dpadCanvas");
				var ctx = c.getContext("2d");
				ctx.moveTo(dpadArea[0][1].x, dpadArea[0][1].y);
				ctx.lineTo(dpadArea[0][1].x, canvasH);
				ctx.moveTo(dpadArea[0][2].x, dpadArea[0][2].y);
				ctx.lineTo(dpadArea[0][2].x, canvasH);				
				ctx.moveTo(dpadArea[1][0].x, dpadArea[1][0].y);
				ctx.lineTo(canvasW, dpadArea[1][0].y);
				ctx.moveTo(dpadArea[2][0].x, dpadArea[2][0].y);
				ctx.lineTo(canvasW, dpadArea[2][0].y);				
				ctx.strokeStyle = "#FF0000";
				ctx.stroke();
				
				var img = new Image();				
				img.src = "images/dpadNormal.png";
				img.onload = function() {
					ctx.drawImage(img, 0, 0, 240, canvasH);
				}				
			}			
			
			function drawDpad(arrow) {
				console.log("call drawDpad");
				var c = document.getElementById("dpadCanvas");
				var ctx = c.getContext("2d");
				var img = new Image();				
				if (arrow == 1) {
					img.src = "images/dpadLeft.png";
				} else if (arrow == 2) {
					img.src = "images/dpadUp.png";
				} else if (arrow == 3) {
					img.src = "images/dpadRight.png";
				} else if (arrow == 4) {
					img.src = "images/dpadDown.png";
				} else {
					img.src = "images/dpadNormal.png";
				}								
				img.onload = function() {
					ctx.drawImage(img, 0, 0, canvasW, canvasH);
				}				
			}
		</script>
		
		<style type="text/css">
			html {
				height: 100%;
			}
			body {
				margin: 0px;
				background-color: #FFFFFF;
				height: 100%;
				width: 100%;
			}
			#container {
				
			}
			#container:fullscreen {
				width: 100%;
				height: 100%;
				background-color: red;
			}
			#container:-webkit-full-screen {
				width: 100%;
				height: 100%;
				background-color: green;
			}
			#orientation-status {
				text-align: center;
				margin: 2px 0;
				color: white;
			}
			<!-- button { -->
				<!-- background-color: white; -->
				<!-- border: 1px solid #336699; -->
				<!-- color: #336699; -->
				<!-- width: 240px; -->
				<!-- padding: 2px; -->
				<!-- display: block; -->
				<!-- margin-left: auto; -->
				<!-- margin-right: auto; -->
				<!-- font-weight: 700; -->
				<!-- outline: none; -->
			<!-- } -->
			#btnLockLandscape {				
			}

			#btnUnlockLandscape {
				display: none;
			}
			
			.arrow {
			  padding: 5px 5px;
			  font-size: 0px;
			  text-align: center;
			  width: 80px;
			  height: 80px;
			  cursor: pointer;
			  outline: none;
			  color: #fff;
			  background-color: #FFFFFF;
			  border: none;
			  border-radius: 0px;
			  box-shadow: 0 0px #999;
			}			
			.arrow:hover 
			{
				background-color: #5fd364
			}			
			.arrow:active {
			  background-color: #3e8e41;
			  box-shadow: 0 0px #666;
			  transform: translateY(0px);
			}
	</style>
    </body>
</html>


