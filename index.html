 <html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta name="google" content="notranslate">
		<meta name="apple-mobile-web-app-capable" content="yes">
	</head>
    <body oncontextmenu="return false;" onselectstart="return false" overscroll-behavior-y: contain;>
		<div>
			<div style="width: 100%; float:left;" align="center">
				<canvas id="dpadCanvas" width="720" height="360" style="border:solid black 1px;" >canvas</canvas>
			</div>
		</div>
		<div align="center">
			<div >
				<input type="text" id="hostAddress" name="hostAddress" value="10.64.3.146">				
				<input type="button" id="connect" onclick="connectServer()" value="Connect">
				<label for="data" id="lbldata" style="display: none;">Send data:</label>
				<input type="text" id="data" name="data" value="data 1" style="display: none;"><br>
				<input type="button" id="btnData" onclick="sendData()" value="Send Data" style="display: none;"><br>
			</div>			
		</div>

		<script>
			//----------------- Server begin -----------------//
			let connected = 0;
            let ws;

            function connectServer() {
                let host = document.getElementById("hostAddress").value;
                //let port = document.getElementById("port").value;
                let port = "12345";
                let hostPortWS = "ws://" + host + ":" + port;
                console.log("hostPortWS: " + hostPortWS);

                ws = new WebSocket(hostPortWS);

                ws.addEventListener("open", () => {
                    console.log("We are connected!");
                    connected = 1;
					document.getElementById("lbldata").style.display = "block";
                    document.getElementById("data").style.display = "block";
                    document.getElementById("btnData").style.display = "block";
                    document.getElementById("connect").setAttribute("disabled", true);
                    document.getElementById("hostAddress").setAttribute("disabled", true);                    
                })

                ws.addEventListener("message", e => {
                    console.log(e);
                });

                ws.addEventListener("close", e => {
                    console.log(e);
                    connected = 0;
                });

                ws.addEventListener("error", e => {
                    console.log(e);
                });
            }

			function sendData() {
                if(connected == 1) {
                    let data = document.getElementById("data").value;
                    ws.send(data);
                }
            }

			function sendAction(a) {
				console.log("sendAction: " + a);
                if(connected == 1) {
                    let action = a;
                    ws.send(action);
                }
            }
			//----------------- Server end -----------------//
			var imgDpadLeft, imgDpadRight, imgDpadUp, imgDpadDown;
			var imgActionX, imgActionY, imgActionA, imgActionB;
			var imgActionXP, imgActionYP, imgActionAP, imgActionBP;
			var imgActionL, imgActionLP, imgActionR, imgActionRP, imgBack, imgBackP;
			var imgLockLandscape, imgLockLandscapeP, imgUnlockLandscape, imgUnlockLandscapeP;
			var imgDpadNormal, imgDpadBG;
			var dpadArea = new Array;
			var canvasW, canvasH;
			var dpadPosX, dpadPosY;
			var arrowW, arrowH;
			var actionArea = new Array;
			var actionPosX, actionPosY;
			var actionW, actionH;
			var isLandscape = false;

			function init(){
				var c = document.getElementById("dpadCanvas");
				var ctx = c.getContext("2d");
				canvasW = c.width;
				canvasH = c.height;
				ctx.fillStyle = "#080D11";
				ctx.fillRect(0, 0, canvasW, canvasH);

				//load dpad button
				dpadPosX = 20;
				dpadPosY = 50;
				arrowW = 72;
				arrowH = 72;
				dpadArea = [
					[{x:dpadPosX, y:dpadPosY, active:false}, {x:(dpadPosX+arrowW), y:dpadPosY, active:false}, {x:(dpadPosX+arrowW*2), y:dpadPosY, active:false}],
					[{x:dpadPosX, y:(dpadPosY+arrowH), active:false}, {x:(dpadPosX+arrowW), y:(dpadPosY+arrowH), active:false}, {x:(dpadPosX+arrowW*2), y:(dpadPosY+arrowH), active:false}],
					[{x:dpadPosX, y:(dpadPosY+arrowH*2), active:false}, {x:(dpadPosX+arrowW), y:(dpadPosY+arrowH*2), active:false}, {x:(dpadPosX+arrowW*2), y:(dpadPosY+arrowH*2), active:false}]
				];

				//load action button
				actionW = 80;
				actionH = 80;
				actionArea = [
					{x:canvasW-130-140, y:40+60,  w:actionW, h:actionH, active:false},
					{x:canvasW-130-70, 	y:40,     w:actionW, h:actionH, active:false},
					{x:canvasW-130-70, 	y:40+120, w:actionW, h:actionH, active:false},
					{x:canvasW-130, 	y:40+60,  w:actionW, h:actionH, active:false},
					{x:20, y:canvasH-75, w:50, h:60, active:false},
					{x:canvasW-70, y:canvasH-75, w:50, h:60, active:false},
					{x:canvasW/2-(actionW/2), y:canvasH-160, w:actionW, h:actionH, active:false},
					{x:canvasW/2-25, y:20, w:50, h:50, active:false},
					{x:screen.width/2-80, y:canvasH/2-80, w:160, h:160, active:false} //for temp
				];
				if (isPortrait()) {
					drawSwitchModeButton();
				} else {
					loadDpadButton();
				}
			}

			//----------------- Action -----------------//
			function arrowDisactiveAll() {
				for (var i=0; i<3; i++) {
					for (var j=0; j<3; j++) {
						dpadArea[i][j].active = false;
					}
				}
			}

			function arrowDisactive(a, b) {
				for (var i=0; i<3; i++) {
					for (var j=0; j<3; j++) {
						dpadArea[i][j].active = false;
					}
				}
				dpadArea[a][b].active = true;
			}

			function arrowActiveCount() {
				var count = 0;
				for (var i=0; i<3; i++) {
					for (var j=0; j<3; j++) {
						if (dpadArea[i][j].active == true){
							count += 1;
						}
					}
				}
				return count;
			}

			//----------------- Control -----------------//
			function handleClick(event) {
				var el = document.getElementById("dpadCanvas");
				var x = event.pageX - el.getBoundingClientRect().left;
				var y = event.pageY - el.getBoundingClientRect().top;
				if (!isLandscape) {
					if ((x > actionArea[8] .x) && (x < actionArea[8].x + actionArea[8].w) && (y > actionArea[8].y) && (y < actionArea[8].y + actionArea[8].h)) {
						openFullscreen(event);
						loadDpadButton();
					}
				}
			}

			function handleStart(event) {
				var el = document.getElementById("dpadCanvas");
				var x = event.changedTouches[0].pageX - el.getBoundingClientRect().left;
				var y = event.changedTouches[0].pageY - el.getBoundingClientRect().top;

				if (isLandscape) {
					<!-- drawTouchPoint(x, y); -->
					if ((x > dpadArea[0][0].x) && (x <= dpadArea[0][1].x)) {
						console.log("Col 1");
						if ((y > dpadArea[0][0].y) && (y <= dpadArea[1][0].y)) {
							console.log("Left & Up");
						} else if ((y > dpadArea[1][0].y) && (y <= dpadArea[2][0].y)) {
							console.log("Left");
							dpadArea[1][0].active = true;
							drawDpad(1);
							sendAction(21);
						} else if ((y > dpadArea[2][0].y) && y<=(dpadArea[2][0].y + arrowH)) {
							console.log("Left & Down");
						}
					}
					else if ((x > dpadArea[0][1].x) && (x <= dpadArea[0][2].x)) {
						console.log("Col 2");
						if ((y > dpadArea[0][0].y) && (y <= dpadArea[1][0].y)) {
							console.log("Up");
							dpadArea[0][1].active = true;
							drawDpad(2);
							sendAction(19);
						} else if ((y > dpadArea[1][0].y) && (y <= dpadArea[2][0].y)) {
							console.log("Middle");
						} else if ((y > dpadArea[2][0].y) && y<=(dpadArea[2][0].y + arrowH)) {
							console.log("Down");
							dpadArea[2][1].active = true;
							drawDpad(4);
							sendAction(20);
						}
					} else if ((x > dpadArea[0][2].x) && x<=(dpadArea[0][2].x + arrowW)) {
						console.log("Col 3");
						if ((y > dpadArea[0][0].y) && (y <= dpadArea[1][0].y)) {
							console.log("Right & Up");
						} else if ((y > dpadArea[1][0].y) && (y <= dpadArea[2][0].y)) {
							console.log("Right");
							dpadArea[1][2].active = true;
							drawDpad(3);
							sendAction(22);
						} else if ((y > dpadArea[2][0].y) && y<=(dpadArea[2][0].y + arrowH)) {
							console.log("Right & Down");
						}
					}

					if ((x > actionArea[0].x) && (x < actionArea[0].x + actionW) && (y > actionArea[0].y) && (y < actionArea[0].y + actionH)) {
						console.log("OnClick - Button X");
						drawActionPressed(52);
						sendAction(52);
					}
					if ((x > actionArea[1].x) && (x < actionArea[1].x + actionW) && (y > actionArea[1].y) && (y < actionArea[1].y + actionH)) {
						console.log("OnClick - Button Y");
						drawActionPressed(53);
						sendAction(53);
					}
					if ((x > actionArea[2].x) && (x < actionArea[2].x + actionW) && (y > actionArea[2].y) && (y < actionArea[2].y + actionH)) {
						console.log("OnClick - Button A");
						drawActionPressed(29);
						sendAction(29);
					}
					if ((x > actionArea[3].x) && (x < actionArea[3].x + actionW) && (y > actionArea[3].y) && (y < actionArea[3].y + actionH)) {
						console.log("OnClick - Button B");
						drawActionPressed(30);
						sendAction(30);
					}
					if ((x > actionArea[4].x) && (x < actionArea[4].x + actionArea[4].w) && (y > actionArea[4].y) && (y < actionArea[4].y + actionArea[4].h)) {
						console.log("OnClick - Button Left");
						drawActionPressed(40);
						sendAction(40);
					}
					if ((x > actionArea[5].x) && (x < actionArea[5].x + actionArea[5].w) && (y > actionArea[5].y) && (y < actionArea[5].y + actionArea[5].h)) {
						console.log("OnClick - Button Right");
						drawActionPressed(46);
						sendAction(46);
					}
					if ((x > actionArea[6].x) && (x < actionArea[6].x + actionArea[6].w) && (y > actionArea[6].y) && (y < actionArea[6].y + actionArea[6].h)) {
						console.log("OnClick - Button BACK");
						drawActionPressed(44);
						sendAction(44);
					}
					if ((x > actionArea[7] .x) && (x < actionArea[7].x + actionArea[7].w) && (y > actionArea[7].y) && (y < actionArea[7].y + actionArea[7].h)) {
						console.log("OnClick - Button FULL");
						drawActionPressed(169);
					}
				}
			}

			function handleMove(event) {
				var el = document.getElementById("dpadCanvas");
				var x = event.changedTouches[0].pageX - el.getBoundingClientRect().left;
				var y = event.changedTouches[0].pageY - el.getBoundingClientRect().top;

				if (isLandscape) {
					<!-- drawTouchPoint(x, y); -->
					if ((x > dpadArea[0][0].x) && (x <= dpadArea[0][1].x)) {
						if ((y > dpadArea[0][0].y) && (y <= dpadArea[1][0].y)) {
						} else if ((y > dpadArea[1][0].y) && (y <= dpadArea[2][0].y)) {
							if (!dpadArea[1][0].active) {
								drawDpad(1);
								arrowDisactive(1,0);
								sendAction(21);
							}
						} else if ((y > dpadArea[2][0].y) && y<=(dpadArea[2][0].y + arrowH)) {
						}
					}
					else if ((x > dpadArea[0][1].x) && (x <= dpadArea[0][2].x)) {
						if ((y > dpadArea[0][0].y) && (y <= dpadArea[1][0].y)) {
							if (!dpadArea[0][1].active) {
								drawDpad(2);
								arrowDisactive(0,1);
								sendAction(19);
							}
						} else if ((y > dpadArea[1][0].y) && (y <= dpadArea[2][0].y)) {
						} else if ((y > dpadArea[2][0].y) && y<=(dpadArea[2][0].y + arrowH)) {
							if (!dpadArea[2][1].active) {
								drawDpad(4);
								arrowDisactive(2,1);
								sendAction(20);
							}
						}
					} else if ((x > dpadArea[0][2].x) && x<=(dpadArea[0][2].x + arrowW)) {
						if ((y > dpadArea[0][0].y) && (y <= dpadArea[1][0].y)) {
						} else if ((y > dpadArea[1][0].y) && (y <= dpadArea[2][0].y)) {
							if (!dpadArea[1][2].active) {
								drawDpad(3);
								arrowDisactive(1,2);
								sendAction(22);
							}
						} else if ((y > dpadArea[2][0].y) && y<=(dpadArea[2][0].y + arrowH)) {
						}
					}
					/*if ((x > actionArea[0].x) && (x < actionArea[0].x + actionW) && (y > actionArea[0].y) && (y < actionArea[0].y + actionH)) {
						drawActionRelease(52);
					}
					if ((x > actionArea[1].x) && (x < actionArea[1].x + actionW) && (y > actionArea[1].y) && (y < actionArea[1].y + actionH)) {
						drawActionRelease(53);
					}
					if ((x > actionArea[2].x) && (x < actionArea[2].x + actionW) && (y > actionArea[2].y) && (y < actionArea[2].y + actionH)) {
						drawActionRelease(29);
					}
					if ((x > actionArea[3].x) && (x < actionArea[3].x + actionW) && (y > actionArea[3].y) && (y < actionArea[3].y + actionH)) {
						drawActionRelease(30);
					}
					if ((x > actionArea[4].x) && (x < actionArea[4].x + actionArea[4].w) && (y > actionArea[4].y) && (y < actionArea[4].y + actionArea[4].h)) {
						drawActionRelease(40);
					}
					if ((x > actionArea[5].x) && (x < actionArea[5].x + actionArea[5].w) && (y > actionArea[5].y) && (y < actionArea[5].y + actionArea[5].h)) {
						drawActionRelease(46);
					}
					if ((x > actionArea[6].x) && (x < actionArea[6].x + actionArea[6].w) && (y > actionArea[6].y) && (y < actionArea[6].y + actionArea[6].h)) {
						drawActionRelease(44);
					}*/
				}
			}

			function handleEnd(event) {
				var el = document.getElementById("dpadCanvas");
				var x = event.changedTouches[0].pageX - el.getBoundingClientRect().left;
				var y = event.changedTouches[0].pageY - el.getBoundingClientRect().top;

				if (isLandscape) {
					if ((x > dpadArea[0][0].x) && (x <= dpadArea[0][1].x)) {
						if ((y > dpadArea[0][0].y) && (y <= dpadArea[1][0].y)) {
							//do nothing
						} else if ((y > dpadArea[1][0].y) && (y <= dpadArea[2][0].y)) {
							if (dpadArea[1][0].active) {
								sendAction(210);
								console.log("Left - Release");
							}
						} else if ((y > dpadArea[2][0].y) && y<=(dpadArea[2][0].y + arrowH)) {
							//do nothing
						}
					}
					else if ((x > dpadArea[0][1].x) && (x <= dpadArea[0][2].x)) {
						if ((y > dpadArea[0][0].y) && (y <= dpadArea[1][0].y)) {
							if (dpadArea[0][1].active) {
								sendAction(190);
								console.log("Up - Release");
							}
						} else if ((y > dpadArea[1][0].y) && (y <= dpadArea[2][0].y)) {
							//do nothing
						} else if ((y > dpadArea[2][0].y) && y<=(dpadArea[2][0].y + arrowH)) {
							if (dpadArea[2][1].active) {
								sendAction(200);
								console.log("Down  - Release");
							}
						}
					} else if ((x > dpadArea[0][2].x) && x<=(dpadArea[0][2].x + arrowW)) {
						if ((y > dpadArea[0][0].y) && (y <= dpadArea[1][0].y)) {
							//do nothing
						} else if ((y > dpadArea[1][0].y) && (y <= dpadArea[2][0].y)) {
							if (dpadArea[1][2].active) {
								sendAction(220);
								console.log("Right - Release");
							}
						} else if ((y > dpadArea[2][0].y) && y<=(dpadArea[2][0].y + arrowH)) {
							//do nothing
						}
					}
					if ((x > actionArea[0].x) && (x < actionArea[0].x + actionW) && (y > actionArea[0].y) && (y < actionArea[0].y + actionH)) {
						console.log("OnClick - Button X Release");
						drawActionRelease(52);
						sendAction(520);
					}
					if ((x > actionArea[1].x) && (x < actionArea[1].x + actionW) && (y > actionArea[1].y) && (y < actionArea[1].y + actionH)) {
						console.log("OnClick - Button Y  Release");
						drawActionRelease(53);
						sendAction(530);
					}
					if ((x > actionArea[2].x) && (x < actionArea[2].x + actionW) && (y > actionArea[2].y) && (y < actionArea[2].y + actionH)) {
						console.log("OnClick - Button A Release");
						drawActionRelease(29);
						sendAction(290);
					}
					if ((x > actionArea[3].x) && (x < actionArea[3].x + actionW) && (y > actionArea[3].y) && (y < actionArea[3].y + actionH)) {
						console.log("OnClick - Button B Release");
						drawActionRelease(30);
						sendAction(300);
					}
					if ((x > actionArea[4].x) && (x < actionArea[4].x + actionArea[4].w) && (y > actionArea[4].y) && (y < actionArea[4].y + actionArea[4].h)) {
						console.log("OnClick - Button Left Release");
						drawActionRelease(40);
						sendAction(400);
					}
					if ((x > actionArea[5].x) && (x < actionArea[5].x + actionArea[5].w) && (y > actionArea[5].y) && (y < actionArea[5].y + actionArea[5].h)) {
						console.log("OnClick - Button Right Release");
						drawActionRelease(46);
						sendAction(460);
					}
					if ((x > actionArea[6].x) && (x < actionArea[6].x + actionArea[6].w) && (y > actionArea[6].y) && (y < actionArea[6].y + actionArea[6].h)) {
						console.log("OnClick - Button BACK Release");
						drawActionRelease(44);
						sendAction(440);
					}
					if ((x > actionArea[7] .x) && (x < actionArea[7].x + actionArea[7].w) && (y > actionArea[7].y) && (y < actionArea[7].y + actionArea[7].h)) {
						console.log("OnClick - Button FULL Release");
						drawActionRelease(169);
						if (!isLandscape) {
							openFullscreen(event);
						} else {
							closeFullscreen(event);
						}
					}
					drawDpad(5);
					//drawActionPressed(0);
					arrowDisactiveAll();
				}
			}

			function handleCancel(event) {
				console.log("Touch Cancel");
				drawActionRelease(0);
				arrowDisactiveAll();
			}

			function startup()
			{
				console.log("call startup()");
				var el = document.getElementById("dpadCanvas");
				el.addEventListener("touchstart", handleStart, false);
				el.addEventListener("touchmove", handleMove, false);
				el.addEventListener("touchend", handleEnd, false);
				el.addEventListener("touchcancel", handleCancel, false);
				el.addEventListener("click", handleClick, false);
			}

			function checkPageFocus() {
				if (!document.hasFocus()) {
					console.log("lost focus");
					if (isLandscape)
					{
						isLandscape = false;
						console.log("set value isLandscape when lost focus");
					}
				}
			}

			//----------------- Init page -----------------//
			init();
			document.addEventListener("ContentLoaded", startup());
			setInterval(checkPageFocus, 500);

			//----------------- Draw dpad -----------------//
			function loadDpadButton() {
				// load and cache all button for improve the performance of drawImage
				var c = document.getElementById("dpadCanvas");
				var ctx = c.getContext("2d");
				var img = new Image();
				//fill canvas
				ctx.fillStyle = "#080D11";
				ctx.fillRect(0, 0, canvasW, canvasH);
				//dpad button
				imgDpadBG = new Image();
				imgDpadBG.src = "images/dpadBG.png";
				imgDpadBG.onload = function() {
					ctx.drawImage(imgDpadBG, dpadPosX-15, dpadPosY-15, arrowW*3+30, arrowH*3+30);
				}
				imgDpadNormal = new Image();
				imgDpadNormal.src = "images/dpadNormal.png";
				imgDpadNormal.onload = function() {
					ctx.drawImage(imgDpadNormal, dpadPosX, dpadPosY, arrowW*3, arrowH*3);
				}
				imgDpadLeft = new Image();
				imgDpadLeft.src = "images/dpadLeft.png";
				imgDpadRight = new Image();
				imgDpadRight.src = "images/dpadRight.png";
				imgDpadUp = new Image();
				imgDpadUp.src = "images/dpadUp.png";
				imgDpadDown = new Image();
				imgDpadDown.src = "images/dpadDown.png";

				//action button
				imgActionX = new Image();
				imgActionX.src = "images/buttonX.png";
				imgActionX.onload = function() {
					ctx.drawImage(imgActionX, actionArea[0].x, actionArea[0].y, actionArea[0].w, actionArea[0].h);
				}
				imgActionY = new Image();
				imgActionY.src = "images/buttonY.png";
				imgActionY.onload = function() {
					ctx.drawImage(imgActionY, actionArea[1].x, actionArea[1].y, actionArea[1].w, actionArea[1].h);
				}
				imgActionA = new Image();
				imgActionA.src = "images/buttonA.png";
				imgActionA.onload = function() {
					ctx.drawImage(imgActionA, actionArea[2].x, actionArea[2].y, actionArea[2].w, actionArea[2].h);
				}
				imgActionB = new Image();
				imgActionB.src = "images/buttonB.png";
				imgActionB.onload = function() {
					ctx.drawImage(imgActionB, actionArea[3].x, actionArea[3].y, actionArea[3].w, actionArea[3].h);
				}
				imgActionXP = new Image();
				imgActionXP.src = "images/buttonXP.png";
				imgActionYP = new Image();
				imgActionYP.src = "images/buttonYP.png";
				imgActionAP = new Image();
				imgActionAP.src = "images/buttonAP.png";
				imgActionBP = new Image();
				imgActionBP.src = "images/buttonBP.png";

				// left, right, back button
				imgActionL = new Image();
				imgActionL.src = "images/buttonL.png";
				imgActionL.onload = function() {
					ctx.drawImage(imgActionL, actionArea[4].x, actionArea[4].y, actionArea[4].w, actionArea[4].h);
				}
				imgActionR = new Image();
				imgActionR.src = "images/buttonR.png";
				imgActionR.onload = function() {
					ctx.drawImage(imgActionR, actionArea[5].x, actionArea[5].y, actionArea[5].w, actionArea[5].h);
				}
				imgBack = new Image();
				imgBack.src = "images/buttonBack.png";
				imgBack.onload = function() {
					ctx.drawImage(imgBack, actionArea[6].x, actionArea[6].y, actionArea[6].w, actionArea[6].w);
				}
				imgActionLP = new Image();
				imgActionLP.src = "images/buttonLP.png";
				imgActionRP = new Image();
				imgActionRP.src = "images/buttonRP.png";
				imgBackP = new Image();
				imgBackP.src = "images/buttonBackP.png";

				//full screen button
				imgLockLandscape = new Image();
				imgLockLandscape.src = "images/LockLandscape.png";
				imgLockLandscape.onload = function() {
					ctx.drawImage(imgLockLandscape, actionArea[7].x, actionArea[7].y, actionArea[7].w, actionArea[7].w);
				}
				imgLockLandscapeP = new Image();
				imgLockLandscapeP.src = "images/LockLandscapeP.png";									
				imgUnlockLandscape = new Image();
				imgUnlockLandscape.src = "images/UnlockLandscape.png";
				imgUnlockLandscape.onload = function() {
					if (!isLandscape) {						
						ctx.drawImage(imgUnlockLandscape, actionArea[7].x, actionArea[7].y, actionArea[7].w, actionArea[7].w);
					}
				}
				imgUnlockLandscapeP = new Image();
				imgUnlockLandscapeP.src = "images/UnlockLandscapeP.png";
			}

			function drawSwitchModeButton() {
				var c = document.getElementById("dpadCanvas");
				var ctx = c.getContext("2d");
				var img = new Image();
				img.src = "images/LockLandscape.png";
				if (!isLandscape) {
					ctx.fillStyle = "#080D11";
					ctx.fillRect(0, 0, canvasW, canvasH);
					img.onload = function() {
						ctx.drawImage(img, actionArea[8].x, actionArea[8].y, actionArea[8].w, actionArea[8].w);
					}
				}
			}

			function drawDpad(arrow) {
				console.log("drawDpad: " + arrow);
				var c = document.getElementById("dpadCanvas");
				var ctx = c.getContext("2d");
				if (arrow == 0) {
					ctx.drawImage(imgDpadBG, dpadPosX-15, dpadPosY-15, arrowW*3+30, arrowH*3+30);
				} else if (arrow == 1) {
					ctx.drawImage(imgDpadLeft, dpadPosX, dpadPosY, arrowW*3, arrowH*3);
				} else if (arrow == 2) {
					ctx.drawImage(imgDpadUp, dpadPosX, dpadPosY, arrowW*3, arrowH*3);
				} else if (arrow == 3) {
					ctx.drawImage(imgDpadRight, dpadPosX, dpadPosY, arrowW*3, arrowH*3);
				} else if (arrow == 4) {
					ctx.drawImage(imgDpadDown, dpadPosX, dpadPosY, arrowW*3, arrowH*3);
				} else if (arrow == 5) {
					ctx.drawImage(imgDpadNormal, dpadPosX, dpadPosY, arrowW*3, arrowH*3);
				} else {
					ctx.drawImage(imgDpadNormal, dpadPosX, dpadPosY, arrowW*3, arrowH*3);
				}
			}

			function drawActionPressed(arrow) {
				console.log("drawActionPressed: " + arrow);
				var c = document.getElementById("dpadCanvas");
				var ctx = c.getContext("2d");
				if (arrow == 52) {
					ctx.drawImage(imgActionXP, actionArea[0].x, actionArea[0].y, actionArea[0].w, actionArea[0].h);
				} else if (arrow == 53) {
					ctx.drawImage(imgActionYP, actionArea[1].x, actionArea[1].y, actionArea[1].w, actionArea[1].h);
				} else if (arrow == 29) {
					ctx.drawImage(imgActionAP, actionArea[2].x, actionArea[2].y, actionArea[2].w, actionArea[2].h);
				} else if (arrow == 30) {
					ctx.drawImage(imgActionBP, actionArea[3].x, actionArea[3].y, actionArea[3].w, actionArea[3].h);
				} else if (arrow == 40) {
					ctx.drawImage(imgActionLP, actionArea[4].x, actionArea[4].y, actionArea[4].w, actionArea[4].h);
				} else if (arrow == 46) {
					ctx.drawImage(imgActionRP, actionArea[5].x, actionArea[5].y, actionArea[5].w, actionArea[5].h);
				} else if (arrow == 44) {
					ctx.drawImage(imgBackP, actionArea[6].x, actionArea[6].y, actionArea[6].w, actionArea[6].w);
				} else if (arrow == 168) {
					ctx.drawImage(imgUnlockLandscapeP, actionArea[7].x, actionArea[7].y, actionArea[7].w, actionArea[7].w);
				} else if (arrow == 169) {
					if (isLandscape) {
						ctx.drawImage(imgLockLandscapeP, actionArea[7].x, actionArea[7].y, actionArea[7].w, actionArea[7].w);
					} else {
						ctx.drawImage(imgUnlockLandscapeP, actionArea[7].x, actionArea[7].y, actionArea[7].w, actionArea[7].w);
					}
				}
			}

			function drawActionRelease(arrow) {
				console.log("drawActionPressed: " + arrow);
				var c = document.getElementById("dpadCanvas");
				var ctx = c.getContext("2d");
				if (arrow == 52) {
					ctx.drawImage(imgActionX, actionArea[0].x, actionArea[0].y, actionArea[0].w, actionArea[0].h);
				} else if (arrow == 53) {
					ctx.drawImage(imgActionY, actionArea[1].x, actionArea[1].y, actionArea[1].w, actionArea[1].h);
				} else if (arrow == 29) {
					ctx.drawImage(imgActionA, actionArea[2].x, actionArea[2].y, actionArea[2].w, actionArea[2].h);
				} else if (arrow == 30) {
					ctx.drawImage(imgActionB, actionArea[3].x, actionArea[3].y, actionArea[3].w, actionArea[3].h);
				} else if (arrow == 40) {
					ctx.drawImage(imgActionL, actionArea[4].x, actionArea[4].y, actionArea[4].w, actionArea[4].h);
				} else if (arrow == 46) {
					ctx.drawImage(imgActionR, actionArea[5].x, actionArea[5].y, actionArea[5].w, actionArea[5].h);
				} else if (arrow == 44) {
					ctx.drawImage(imgBack, actionArea[6].x, actionArea[6].y, actionArea[6].w, actionArea[6].w);
				} else if (arrow == 168) {
					ctx.drawImage(imgUnlockLandscape, actionArea[7].x, actionArea[7].y, actionArea[7].w, actionArea[7].w);
				} else if (arrow == 169) {
					if (isLandscape) {
						ctx.drawImage(imgLockLandscape, actionArea[7].x, actionArea[7].y, actionArea[7].w, actionArea[7].w);
					} else {
						ctx.drawImage(imgUnlockLandscape, actionArea[7].x, actionArea[7].y, actionArea[7].w, actionArea[7].w);
					}
				} else {
					ctx.drawImage(imgActionX, actionArea[0].x, actionArea[0].y, actionArea[0].w, actionArea[0].h);
					ctx.drawImage(imgActionY, actionArea[1].x, actionArea[1].y, actionArea[1].w, actionArea[1].h);
					ctx.drawImage(imgActionA, actionArea[2].x, actionArea[2].y, actionArea[2].w, actionArea[2].h);
					ctx.drawImage(imgActionB, actionArea[3].x, actionArea[3].y, actionArea[3].w, actionArea[3].h);
					ctx.drawImage(imgActionL, actionArea[4].x, actionArea[4].y, actionArea[4].w, actionArea[4].h);
					ctx.drawImage(imgActionR, actionArea[5].x, actionArea[5].y, actionArea[5].w, actionArea[5].h);
					ctx.drawImage(imgBack, 	  actionArea[6].x, actionArea[6].y, actionArea[6].w, actionArea[6].w);
					if (isLandscape) {
						ctx.drawImage(imgLockLandscape, actionArea[7].x, actionArea[7].y, actionArea[7].w, actionArea[7].w);
					} else {
						ctx.drawImage(imgUnlockLandscape, actionArea[7].x, actionArea[7].y, actionArea[7].w, actionArea[7].w);
					}
				}
			}


			//----------------- Webpage -----------------//
			function isPortrait() {
				return window.innerHeight > window.innerWidth;
			}

			function isFullScreen() {
				if (this.fullScreenMode = document.fullScreen || document.mozFullScreen || document.webkitIsFullScreen){
					return true;
				} else {
					return false;
				}
			}

			function CloseWindow() {
				alert("Do you want exit page?");
				window.opener = self;
				window.close();
			}

			function openFullscreen(event) {
				if(document.documentElement.requestFullscreen){
					document.documentElement.requestFullscreen();
				} else if (document.documentElement.webkitRequestFullScreen) {
					document.documentElement.webkitRequestFullScreen();
				}
				screen.orientation.lock("landscape-primary")
					.then(function() {
						isLandscape = true;
						//_LOCK_BUTTON.style.display = 'none';
					})
			}

			function closeFullscreen(event) {
				if(document.exitFullscreen) {
                    document.exitFullscreen();
                }
				screen.orientation.unlock();
				isLandscape = false;
			}

			//when screen orientation changes
			screen.orientation.addEventListener("change", function() {
				if (!isLandscape) {
					drawSwitchModeButton();
				}
			});

			//on exiting full-screen lock is automatically released
			document.addEventListener("fullscreenchange", function() {
				console.log("exiting full-screen lock + isLandscape: "+ isLandscape);
				isLandscape = false;

			});
			document.addEventListener("webkitfullscreenchange", function() {				
				console.log("exiting webkitfullscreenchange lock + isLandscape: "+ isLandscape);				
				isLandscape = false;				
			});

			//----------------- Debug -----------------//
			function drawGrid() {
				var c = document.getElementById("dpadCanvas");
				var ctx = c.getContext("2d");
				ctx.fillStyle = "#00FF00";
				ctx.fillRect(dpadArea[0][0].x, dpadArea[0][0].y, arrowW*3, arrowH*3);
				ctx.moveTo(dpadArea[0][1].x, dpadArea[0][1].y);
				ctx.lineTo(dpadArea[0][1].x, dpadArea[2][1].y+arrowH);
				ctx.moveTo(dpadArea[0][2].x, dpadArea[0][2].y);
				ctx.lineTo(dpadArea[0][2].x, dpadArea[2][2].y+arrowH);
				ctx.moveTo(dpadArea[1][0].x, dpadArea[1][0].y);
				ctx.lineTo(dpadArea[1][2].x+arrowW, dpadArea[1][0].y);
				ctx.moveTo(dpadArea[2][0].x, dpadArea[2][0].y);
				ctx.lineTo(dpadArea[2][2].x+arrowW, dpadArea[2][0].y);
				ctx.strokeStyle = "#FF0000";
				ctx.stroke();
			}

			function drawTouchPoint(x, y) {
				var c = document.getElementById("dpadCanvas");
				var ctx = c.getContext("2d");
				ctx.fillStyle = "#FF0000";
				ctx.fillRect(x, y, 2, 2);
			}
		</script>

		<style type="text/css">
			html {
				height: 100%;
			}
			body {
				margin: 0px;
				background-color: #080D11;
				height: 100%;
				width: 100%;
				touch-action: none;
			}
		</style>
    </body>
</html>


